<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒã‚±ãƒ¢ãƒ³å›³é‘‘ç•ªå·æ¤œå®š</title>

<style>
body { font-family: system-ui, sans-serif; margin:0; padding:10px; background:#f5f5f5; }
.container { max-width:500px; margin:auto; background:#fff; padding:15px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,.1); }
h1 { text-align:center; font-size:1.4em; }
select, input, button { width:100%; font-size:1.05em; padding:10px; margin:8px 0; }
.hidden { display:none; }
#timer { color:red; font-weight:bold; }
.gen-container { display:grid; grid-template-columns:1fr 1fr; gap:5px; border:1px solid #ccc; padding:5px; border-radius:5px; }
.gen-container label { position:relative; padding-left:5px; height:26px; line-height:26px; }
.gen-container input { position:absolute; right:5px; top:4px; transform:scale(1.2); }
#message { white-space:pre-wrap; margin:10px 0; }
.record { font-size:.95em; border-top:1px solid #ccc; padding-top:5px; margin-top:5px; }
</style>
</head>

<body>
<div class="container">
<h1>ãƒã‚±ãƒ¢ãƒ³å›³é‘‘ç•ªå·æ¤œå®š</h1>

<label>ãƒ«ãƒ¼ãƒ«</label>
<select id="rule">
  <option value="endless">ã‚¨ãƒ³ãƒ‰ãƒ¬ã‚¹</option>
  <option value="timeattack">ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯</option>
</select>

<label>ãƒ¢ãƒ¼ãƒ‰</label>
<select id="mode">
  <option value="num2poke">ç•ªå·â†’ãƒã‚±ãƒ¢ãƒ³</option>
  <option value="poke2num">ãƒã‚±ãƒ¢ãƒ³â†’ç•ªå·</option>
</select>

<label id="timeLabel">åˆ¶é™æ™‚é–“</label>
<select id="timeSelect">
  <option value="0">åˆ¶é™ãªã—</option>
  <option value="3">3ç§’</option>
  <option value="5">5ç§’</option>
  <option value="10">10ç§’</option>
  <option value="20">20ç§’</option>
  <option value="30" selected>30ç§’</option>
</select>

<label>ä¸–ä»£</label>
<div class="gen-container" id="gens"></div>

<div id="bestEndless"></div>
<div id="bestTA"></div>

<div id="message"></div>
<button onclick="startGame()">ã‚²ãƒ¼ãƒ é–‹å§‹</button>

<div id="game" class="hidden">
  å‡ºé¡Œï¼š<span id="question"></span><br>
  â± <span id="timer"></span><br>
  æ­£è§£æ•°ï¼š<span id="score">0</span><br>
  <input id="answer" autocomplete="off">
  <button onclick="check()">åˆ¤å®š</button>
  <button onclick="giveUp()">ã‚®ãƒ–ã‚¢ãƒƒãƒ—</button>
</div>
</div>

<script>
const gens = {
  kanto:[1,151,"ã‚«ãƒ³ãƒˆãƒ¼"], johto:[152,251,"ã‚¸ãƒ§ã‚¦ãƒˆ"], hoenn:[252,386,"ãƒ›ã‚¦ã‚¨ãƒ³"],
  sinnoh:[387,493,"ã‚·ãƒ³ã‚ªã‚¦"], unova:[494,649,"ã‚¤ãƒƒã‚·ãƒ¥"],
  kalos:[650,721,"ã‚«ãƒ­ã‚¹"], alola:[722,809,"ã‚¢ãƒ­ãƒ¼ãƒ©"],
  galar:[810,906,"ã‚¬ãƒ©ãƒ«"], paldea:[907,1025,"ãƒ‘ãƒ«ãƒ‡ã‚¢"], all:[1,1025,"å…¨ã¦"]
};

let pokemon={}, numbers=[], pool=[], used=[];
let timer=null,startTime=0,timeLeft=0,score=0,current=null;

const rule=document.getElementById("rule");
const mode=document.getElementById("mode");
const timeSelect=document.getElementById("timeSelect");
const gensDiv=document.getElementById("gens");
const message=document.getElementById("message");
const game=document.getElementById("game");

fetch("pokemon.json").then(r=>r.json()).then(d=>{
  pokemon=d;
  numbers=Object.keys(d).map(Number);
});

Object.entries(gens).forEach(([k,v])=>{
  gensDiv.innerHTML+=`<label>${v[2]}<input type="checkbox" value="${k}" ${k==="all"?"checked":""}></label>`;
});

rule.onchange=()=>{
  const ta=rule.value==="timeattack";
  timeSelect.classList.toggle("hidden",ta);
  document.getElementById("timeLabel").classList.toggle("hidden",ta);
  updateRecords();
};

mode.onchange=timeSelect.onchange=updateRecords;
gensDiv.onchange=e=>{
  if(rule.value==="timeattack"){
    gensDiv.querySelectorAll("input").forEach(c=>c.checked=false);
    e.target.checked=true;
  }
  updateRecords();
};

function selectedGen(){
  return [...gensDiv.querySelectorAll("input")].find(c=>c.checked)?.value||"all";
}

function keyTA(g){ return `ta_${mode.value}_${g}`; }
function keyEnd(){ return `end_${mode.value}_${timeSelect.value}`; }

function updateRecords(){
  document.getElementById("bestEndless").textContent="";
  document.getElementById("bestTA").textContent="";
  if(rule.value==="endless"){
    const b=JSON.parse(localStorage.getItem(keyEnd())||"[0,0,0]");
    document.getElementById("bestEndless").textContent=`æœ€é«˜è¨˜éŒ²ï¼š${b.join(" / ")}`;
  }else{
    Object.entries(gens).forEach(([k,v])=>{
      const d=JSON.parse(localStorage.getItem(keyTA(k))||"null");
      if(!d||!d.clear) return;
      document.getElementById("bestTA").innerHTML+=
        `<div class="record">${v[2]}${d.clear?"ğŸ‘‘":""}<br>
        æ­£è§£æ•°ï¼š${d.score}<br>ã‚¿ã‚¤ãƒ ï¼š${fmt(d.time)}<br>
        ${d.clear>0?`ã‚¯ãƒªã‚¢å›æ•°ï¼š${d.clear}`:""}</div>`;
    });
  }
}

function startGame(){
  score=0; used=[];
  pool=[];
  const g=selectedGen();
  for(let i=gens[g][0];i<=gens[g][1];i++) pool.push(i);
  if(rule.value==="timeattack"){ startTime=Date.now(); }
  else timeLeft=+timeSelect.value;
  game.classList.remove("hidden");
  message.textContent="";
  next();
}

function next(){
  if(rule.value==="timeattack" && pool.length===0){
    end("ã‚¯ãƒªã‚¢ï¼");
    return;
  }
  current = rule.value==="timeattack"
    ? pool.splice(Math.floor(Math.random()*pool.length),1)[0]
    : pool[Math.floor(Math.random()*pool.length)];
  question.textContent = mode.value==="num2poke"?current:pokemon[current];
  answer.value="";
  answer.focus({preventScroll:true});
  clearInterval(timer);
  if(rule.value==="endless" && timeLeft>0){
    timer=setInterval(()=>{
      timeLeft--;
      timerEl.textContent=timeLeft;
      if(timeLeft<=0) end("æ™‚é–“åˆ‡ã‚Œï¼");
    },1000);
  }
}

function check(){
  clearInterval(timer);
  const a=answer.value.trim();
  const c=mode.value==="num2poke"?pokemon[current]:String(current);
  if(a===c){ score++; scoreEl.textContent=score; next(); }
  else end("ä¸æ­£è§£ï¼");
}

function giveUp(){ end("ã‚®ãƒ–ã‚¢ãƒƒãƒ—ï¼"); }

function end(r){
  clearInterval(timer);
  let msg=r+"\nã‚¹ã‚³ã‚¢ï¼š"+score;
  if(rule.value==="timeattack"){
    const t=(Date.now()-startTime)/1000;
    msg+="\nã‚¿ã‚¤ãƒ ï¼š"+fmt(t);
  }
  message.textContent=msg;
  game.classList.add("hidden");
  updateRecords();
}

function fmt(s){
  const m=Math.floor(s/60);
  const sec=Math.floor(s%60);
  return `${String(m).padStart(2,"0")}:${String(sec).padStart(2,"0")}`;
}

updateRecords();
</script>
</body>
</html>
